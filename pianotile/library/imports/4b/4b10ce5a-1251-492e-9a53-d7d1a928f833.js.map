{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\main-script.js"],"names":["cc","Class","extends","Component","editor","properties","movePanel","Node","bluePrefab","Prefab","whitePrefab","blackPrefab","longPrefab","redPrefab","initRow","tileWidth","tileHeight","speed","_newTopRow","_curBottomRow","_startPosition","_isFirstTile","_start","_end","_idx","_preTx","_tx","_arr","_tilesArr","_errors","_offestY","_soundArr","_soundData","initSong","data","musics","console","log","arr","scores","score","replaceAll","split","onLoad","position","node","director","getScene","getChildByName","getComponent","getdata","songURL","url","loader","loadRes","onLoadMusicCompleted","bind","i","addTile","err","res","onTap","name","a","indexOf","replace","length","resources","find","resource","audioEngine","play","raw","checkWin","y","Math","floor","random","num","prefab","type","tile","splice","push","children","rand","instantiate","init","scaleX","scaleY","addChild","x","_destory","getCurrentTile","update","dt","curTile","scrollback","showWrongBlackTile","gameover","forEach","destroyTile","duraction","jumpUp","moveBy","p","easing","easeCubicActionOut","child","runAction","fadeIn","fadeOut","sequences","sequence","showWrongRedTile","removeChild","e","substring","lastIndexOf"],"mappings":"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","file":"main-script.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["import resource from 'index'\r\n\r\ncc.Class({\r\n\textends: cc.Component,\r\n\r\n\teditor: {\r\n\t\t//executeInEditMode: true\r\n\t},\r\n\r\n\tproperties: {\r\n\t\tmovePanel: cc.Node,\r\n\t\tbluePrefab: cc.Prefab,\r\n\t\twhitePrefab: cc.Prefab,\r\n\t\tblackPrefab: cc.Prefab,\r\n\t\tlongPrefab: cc.Prefab,\r\n\t\tredPrefab: cc.Prefab,\r\n\t\tinitRow: 7,\r\n\t\ttileWidth: 0,\r\n\t\ttileHeight: 0,\r\n\t\tspeed: 0,\r\n\t\t_newTopRow: null,\r\n\t\t_curBottomRow: null,\r\n\t\t_startPosition: null,\r\n\t\t_isFirstTile: true,\r\n\t\t_start: false,\r\n\t\t_end: false,\r\n\t\t_idx: 0,\r\n\t\t_preTx: -1,\r\n\t\t_tx: -1,\r\n\t\t_arr: [],\r\n\t\t_tilesArr: [],\r\n\t\t_errors: [],\r\n\t\t_offestY: null,\r\n\t\t_soundArr: null,\r\n\t\t_soundData: null\r\n\t},\r\n\r\n\tinitSong (data) {\r\n\t\tthis._soundData = data.musics[0];\r\n\t\tconsole.log('initSong data', data)\r\n\t\tlet arr,\r\n\t\t\tscores = this._soundData.scores,\r\n\t\t\tscore = scores[0];\r\n\t\tscore = this.replaceAll(score);\r\n\t\tarr = score.split(\",\");\r\n\t\tthis._soundArr = arr;\r\n\t\tconsole.log('arr', arr)\r\n\t},\r\n\r\n\tonLoad () {\r\n\t\tthis._curBottomRow = 0;\r\n\t\tthis._newTopRow = 0;\r\n\t\tthis._startPosition = this.movePanel.position;\r\n\t\tthis._arr = [0, 1, 2, 3]\r\n\t\tthis._idx = 0\r\n\t\tthis._preTx = -1\r\n\t\tthis._tx = -1\r\n\t\tthis._tilesArr = []\r\n\t\tthis._errors = ['ERROR_SPOT']\r\n\t\tthis._offestY = 0\r\n\t\tthis._soundArr = []\r\n\t\tthis._soundData = []\r\n\r\n\t\tconst node = cc.director.getScene().getChildByName('data-store'),\r\n\t\t\tdata = node.getComponent('datastore-script').getdata(),\r\n\t\t\tsongURL = data.url\r\n\t\tconsole.log('songURL', songURL)\r\n\t\tcc.loader.loadRes(songURL, this.onLoadMusicCompleted.bind(this));\r\n\r\n\t\tfor (let i = 0; i <= this.initRow; i++)\r\n\t\t\tthis.addTile()\r\n\t},\r\n\r\n\tonLoadMusicCompleted (err, res) {\r\n\t\tif(err) return\r\n\t\tconsole.log('onLoadMusicCompleted res', res)\r\n\t\tthis.initSong(res)\r\n\t},\r\n\r\n\tonTap () {\r\n\t\tlet name,\r\n\t\t\ta = null,\r\n\t\t\ti = this._soundArr[this._idx];\r\n\t\ti.indexOf(\"(\") > -1 ? (i = i.replace(/\\(/gm, \"\"),\r\n\t\t\ti = i.replace(/\\)/gm, \"\"),\r\n\t\t\ta = i.split(\".\"),\r\n\t\t\tname = a[a.length - 1] + \"_mp3\") : (name = i + \"_mp3\")\r\n\t\tconst res = resource.resources.find((resource) => {\r\n\t\t\treturn resource.name === name\r\n\t\t})\r\n\t\t// res && cc.loader.load(cc.url.raw('resources/'+res.url), function(){\r\n\t\t// \tconsole.log('onTap load end')\r\n\t\t// });\r\n\t\tres && cc.audioEngine.play(cc.url.raw('resources/'+res.url), false, 1)\r\n\t\t// RES.getRes(url)\r\n\t\t// XFlash.playEffect(url, 1)\r\n\t\tthis.checkWin()\r\n\t},\r\n\r\n\tcheckWin() {\r\n\t\tthis._idx++\r\n\t},\r\n\r\n\taddTile () {\r\n\t\tconst y = this._tilesArr.length===0? 0 : this._tilesArr[this._tilesArr.length - 1].y,\r\n\t\t\ti = Math.floor(Math.random() * this._arr.length),\r\n\t\t\tnum = this._arr[i]\r\n\t\tlet prefab = {},\r\n\t\t\ttype = '',\r\n\t\t\ttile = {}\r\n\t\tif (this._arr.splice(i, 1),\r\n\t\t\t-1 !== this._preTx && this._arr.push(this._preTx),\r\n\t\t\t0 === this.movePanel.children.length){\r\n\t\t\tprefab = this.bluePrefab;\r\n\t\t\ttype = 'START'\r\n\t\t} else {\r\n\t\t\tconst rand = Math.floor(Math.random() * 100);\r\n\t\t\tif(30 >= rand) {\r\n\t\t\t\tprefab = this.longPrefab\r\n\t\t\t\ttype = 'LONG'\r\n\t\t\t} else {\r\n\t\t\t\tprefab = this.blackPrefab\r\n\t\t\t\ttype = 'BLACK'\r\n\t\t\t}\r\n\t\t}\r\n\t\ttile = cc.instantiate(prefab);\r\n\t\ttile.getComponent(\"tile-script\").init(type, this);\r\n\t\ttile && (this._tilesArr.push(tile),\r\n\t\t\ttile.name = 'TILE_' + type,\r\n\t\t\ttile.scaleX = this.tileWidth / 135,\r\n\t\t\ttile.scaleY = this.tileHeight / 238,\r\n\t\t\tthis.movePanel.addChild(tile),\r\n\t\t\ttile.x = num * this.tileWidth,\r\n\t\t\ttile.y = y + this.tileHeight),\r\n\t\t\ttile._destory = false,\r\n\t\t\tthis._preTx = num\r\n\t},\r\n\r\n\tgetCurrentTile() {\r\n\t\treturn this._tilesArr[this._curBottomRow]\r\n\t},\r\n\r\n\tupdate (dt) {\r\n\t\tif(!this._start || this._end) return\r\n\t\tthis._offestY += this.speed\r\n\t\tconst curTile = this.getCurrentTile()\r\n\t\tif (curTile && curTile.y <= 0 && !curTile._destory) {\r\n\t\t\tconsole.log('gameover')\r\n\t\t\tthis.scrollback()\r\n\t\t\tthis.showWrongBlackTile(curTile)\r\n\t\t\tthis.gameover()\r\n\t\t}\r\n\t\tthis.movePanel.children.forEach(tile => {\r\n\t\t\ttile.y -= this.speed\r\n\t\t\tif (tile && tile._destory && tile.y < 0) {\r\n\t\t\t\tconsole.log('update tile', tile)\r\n\t\t\t\tthis.destroyTile(tile)\r\n\t\t\t\tthis.addTile()\r\n\t\t\t\tthis._newTopRow++\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\r\n\tscrollback() {\r\n\t\tconst duraction = 1.5;\r\n\t\tthis.movePanel.children.forEach(child => {\r\n\t\t\tconst jumpUp = cc.moveBy(duraction, cc.p(0, this.tileHeight)).easing(cc.easeCubicActionOut());\r\n\t\t\tchild.runAction(jumpUp)\r\n\t\t})\r\n\t},\r\n\r\n\tshowWrongBlackTile(tile) {\r\n\t\tconst fadeIn = cc.fadeIn(.6).easing(cc.easeCubicActionOut()),\r\n\t\t\tfadeOut = cc.fadeOut(.6).easing(cc.easeCubicActionOut()),\r\n\t\t\tsequences = [fadeIn, fadeOut, fadeIn, fadeOut, fadeIn]\r\n\t\ttile.runAction(cc.sequence(sequences))\r\n\t},\r\n\r\n\tshowWrongRedTile(x, y) {\r\n\t\tconsole.log('showWrongRedTile x', x)\r\n\t\tconsole.log('showWrongRedTile y', y)\r\n\t\tconst tile = cc.instantiate(this.redPrefab);\r\n\t\tconst fadeIn = cc.fadeIn(.6).easing(cc.easeCubicActionOut()),\r\n\t\t\tfadeOut = cc.fadeOut(.6).easing(cc.easeCubicActionOut()),\r\n\t\t\tsequences = [fadeIn, fadeOut, fadeIn, fadeOut, fadeIn]\r\n\t\ttile && (\r\n\t\t\ttile.name = 'TILE_' + 'RED',\r\n\t\t\t\ttile.scaleX = this.tileWidth / 135,\r\n\t\t\t\ttile.scaleY = this.tileHeight / 238,\r\n\t\t\t\tthis.movePanel.addChild(tile),\r\n\t\t\t\ttile.x = x * this.tileWidth,\r\n\t\t\t\ttile.y = (y + 1 + this._newTopRow) * this.tileHeight - this._offestY,\r\n\t\t\t\ttile.runAction(cc.sequence(sequences)),\r\n\t\t\t\tthis.gameover(this._errors[0])\r\n\t\t)\r\n\t},\r\n\r\n\tdestroyTile (tile) {\r\n\t\tthis.movePanel.removeChild(tile)\r\n\t},\r\n\r\n\tgameover(type) {\r\n\t\t// console.log('gameover')\r\n\t\tthis._end = true\r\n\t},\r\n\r\n\treplaceAll (e) {\r\n\t\treturn e = e.replace(/;/gm, \",\"),\r\n\t\t\te = e.replace(/\\[L\\]/gm, \"\"),\r\n\t\t\te = e.replace(/\\[M\\]/gm, \"\"),\r\n\t\t\te = e.replace(/\\[N\\]/gm, \"\"),\r\n\t\t\te = e.replace(/\\[I\\]/gm, \"\"),\r\n\t\t\te = e.replace(/\\[J\\]/gm, \"\"),\r\n\t\t\te = e.replace(/\\[K\\]/gm, \"\"),\r\n\t\t\te = e.replace(/\\[KL\\]/gm, \"\"),\r\n\t\t\te = e.replace(/\\[JK\\]/gm, \"\"),\r\n\t\t\te = e.replace(/\\[JL\\]/gm, \"\"),\r\n\t\t\te = e.replace(/\\[LM\\]/gm, \"\"),\r\n\t\t\te = e.replace(/\\[LL\\]/gm, \"\"),\r\n\t\t\te = e.replace(/\\[KM\\]/gm, \"\"),\r\n\t\t\te = e.replace(/\\[KKK\\]/gm, \"\"),\r\n\t\t\te = e.replace(/\\[IJ]/gm, \"\"),\r\n\t\t\te = e.replace(/\\[KLM]/gm, \"\"),\r\n\t\t\te = e.replace(/#/gm, \"_\"),\r\n\t\t\te = e.replace(/U,/gm, \"\"),\r\n\t\t\te = e.replace(/T,/gm, \"\"),\r\n\t\t\te = e.replace(/T/gm, \"\"),\r\n\t\t\te = e.replace(/V,/gm, \"\"),\r\n\t\t\te = e.replace(/V>/gm, \"d\"),\r\n\t\t\te = e.replace(/5</gm, \"\"),\r\n\t\t\te = e.replace(/6</gm, \"\"),\r\n\t\t\te = e.replace(/>/gm, \"\"),\r\n\t\t\te = e.replace(/@/gm, \".\"),\r\n\t\t\te = e.replace(/~/gm, \".\"),\r\n\t\t\te = e.replace(/S/gm, \"d\"),\r\n\t\t\te = e.replace(/%/gm, \".\"),\r\n\t\t\te = e.replace(/\\^/gm, \".\"),\r\n\t\t\te = e.replace(/\\&/gm, \".\"),\r\n\t\t\te = e.substring(0, e.lastIndexOf(\",\"))\r\n\t},\r\n});\r\n"]}