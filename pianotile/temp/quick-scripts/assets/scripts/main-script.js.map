{"version":3,"sources":["main-script.js"],"names":["cc","Class","extends","Component","editor","properties","movePanel","Node","bluePrefab","Prefab","whitePrefab","blackPrefab","longPrefab","initRow","initCol","tileWidth","tileHeight","_newTopRow","_curBottomRow","_curTouchRow","_startPosition","_isFirstTile","_start","_idx","_preTx","_tx","_arr","_tilesArr","onLoad","position","i","addTile","console","log","y","length","Math","floor","random","num","prefab","type","tile","splice","push","children","rand","instantiate","getComponent","init","scaleX","scaleY","addChild","x","initSong","move","movePosition","v2","runAction","sequence","moveTo","callFunc","updateRender","bind","row","randomBlackCol","col","name","pMult","oldRow","getChildByName","removeFromParent"],"mappings":"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","file":"main-script.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n\textends: cc.Component,\r\n\r\n\teditor: {\r\n\t\t//executeInEditMode: true\r\n\t},\r\n\r\n\tproperties: {\r\n\t\tmovePanel: cc.Node,\r\n\t\tbluePrefab: cc.Prefab,\r\n\t\twhitePrefab: cc.Prefab,\r\n\t\tblackPrefab: cc.Prefab,\r\n\t\tlongPrefab: cc.Prefab,\r\n\t\tinitRow: 7,\r\n\t\tinitCol: 4,\r\n\t\ttileWidth: 0,\r\n\t\ttileHeight: 0,\r\n\t\t_newTopRow: null,\r\n\t\t_curBottomRow: null,\r\n\t\t_curTouchRow: -1,\r\n\t\t_startPosition: null,\r\n\t\t_isFirstTile: true,\r\n\t\t_start: false,\r\n\t\t_idx: 0,\r\n\t\t_preTx: -1,\r\n\t\t_tx: -1,\r\n\t\t_arr: [0, 1, 2, 3],\r\n\t\t_tilesArr: [],\r\n\t},\r\n\r\n\tonLoad () {\r\n\t\t//加载 填满 屏幕中央\r\n\t\tthis._curBottomRow = 0;\r\n\t\tthis._newTopRow = 6;\r\n\t\tthis._startPosition = this.movePanel.position;\r\n\t\tthis._arr = [0, 1, 2, 3]\r\n\t\tthis._idx = 0\r\n\t\tthis._preTx = -1\r\n\t\tthis._tx = -1\r\n\t\tthis._tilesArr = []\r\n\t\t// for(let row = 0; row < 6; row++){\r\n\t\t// \tlet randomBlackCol = Math.floor(Math.random() * 4);\r\n\t\t// \tfor(let col = 0; col < 4; col++){\r\n\t\t// \t\tlet tile = null;\r\n\t\t// \t\tif(randomBlackCol === col){\r\n\t\t// \t\t\tif(this._isFirstTile) {\r\n\t\t// \t\t\t\tthis._isFirstTile = false\r\n\t\t// \t\t\t\ttile = cc.instantiate(this.bluePrefab);\r\n\t\t// \t\t\t\ttile.getComponent(\"tile-script\").init(\"start\", this);\r\n\t\t// \t\t\t} else {\r\n\t\t// \t\t\t\ttile = cc.instantiate(this.blackPrefab);\r\n\t\t// \t\t\t\ttile.getComponent(\"tile-script\").init(\"black\",this);\r\n\t\t// \t\t\t}\r\n\t\t// \t\t}else{\r\n\t\t// \t\t\ttile = cc.instantiate(this.whitePrefab);\r\n\t\t// \t\t\ttile.getComponent(\"tile-script\").init(\"white\",this);\r\n\t\t// \t\t}\r\n\t\t// \t\tthis.movePanel.addChild(tile);\r\n\t\t// \t\ttile.name = row + \"#\" + col;\r\n\t\t// \t\ttile.position = cc.pMult(cc.v2(col, row), 150);\r\n\t\t// \t\tconsole.log('tile.position', tile.position)\r\n\t\t// \t\tconsole.log('this', this)\r\n\t\t// \t\tconsole.log('this movePanel', this.movePanel)\r\n\t\t// \t}\r\n\t\t// }\r\n\t\tfor (let i = 0; i < this.initRow; i++)\r\n\t\t\tthis.addTile()\r\n\t},\r\n\r\n\taddTile () {\r\n\t\tconsole.log('this._tilesArr', this._tilesArr)\r\n\t\tconst y = this._tilesArr.length===0? 0 : this._tilesArr[this._tilesArr.length - 1].y,\r\n\t\t\ti = Math.floor(Math.random() * 4),\r\n\t\t\tnum = this._arr[i]\r\n\t\tlet prefab = {},\r\n\t\t\ttype = '',\r\n\t\t\ttile = {}\r\n\t\tif (this._arr.splice(i, 1),\r\n\t\t\t-1 !== this._preTx && this._arr.push(this._preTx),\r\n\t\t\t0 === this.movePanel.children.length){\r\n\t\t\tprefab = this.bluePrefab;\r\n\t\t\ttype = 'start'\r\n\t\t} else {\r\n\t\t\tconst rand = Math.floor(Math.random() * 100);\r\n\t\t\tif(30 >= rand) {\r\n\t\t\t\tprefab = this.longPrefab\r\n\t\t\t\ttype = 'long'\r\n\t\t\t} else {\r\n\t\t\t\tprefab = this.blackPrefab\r\n\t\t\t\ttype = 'black'\r\n\t\t\t}\r\n\t\t}\r\n\t\ttile = cc.instantiate(prefab);\r\n\t\ttile.getComponent(\"tile-script\").init(type, this);\r\n\t\ttile && (this._tilesArr.push(tile),\r\n\t\t\ttile.scaleX = this.tileWidth / 126,\r\n\t\t\ttile.scaleY = this.tileHeight / 238,\r\n\t\t\tthis.movePanel.addChild(tile),\r\n\t\t\ttile.x = num * this.tileWidth,\r\n\t\t\ttile.y = y + this.tileHeight),\r\n\t\t\tthis._preTx = num\r\n\t\tconsole.log('tile', tile)\r\n\t},\r\n\r\n\tinitSong() {\r\n\r\n\t},\r\n\r\n\r\n\tmove() {\r\n\t\tconst movePosition = cc.v2(this._startPosition.x,(this._startPosition.y + (this._curBottomRow + 1) * -150));\r\n\t\tconsole.log('move movePosition', movePosition)\r\n\t\tconsole.log('move this.movePanel', this.movePanel)\r\n\t\tthis.movePanel.runAction(cc.sequence(\r\n\t\t\tcc.moveTo(0.2, movePosition),\r\n\t\t\tcc.callFunc(this.updateRender.bind(this))\r\n\t\t))\r\n\t},\r\n\r\n\tupdateRender() {\r\n\t\tlet row = this._newTopRow;\r\n\t\tlet randomBlackCol = Math.floor(Math.random() * 4);\r\n\t\tfor(let col = 0; col < 4; col++){\r\n\t\t\tlet tile = null,\r\n\t\t\t\tprefab = randomBlackCol === col? this.blackPrefab : this.whitePrefab,\r\n\t\t\t\ttype = randomBlackCol === col? \"black\" : \"white\"\r\n\t\t\ttile = cc.instantiate(prefab);\r\n\t\t\ttile.getComponent(\"tile-script\").init(type, this);\r\n\t\t\tthis.movePanel.addChild(tile);\r\n\t\t\ttile.name = row + \"#\" + col;\r\n\t\t\ttile.position = cc.pMult(cc.v2(col,row), 150);\r\n\t\t}\r\n\t\t//移除一行\r\n\t\tlet oldRow = this._curBottomRow;\r\n\t\tfor(let col = 0; col < 4; col++){\r\n\t\t\tthis.movePanel.getChildByName(oldRow + \"#\" + col).removeFromParent();\r\n\t\t}\r\n\t\tthis._curBottomRow++;\r\n\t\tthis._curTouchRow++;\r\n\t\tthis._newTopRow++;\r\n\t},\r\n\r\n\r\n\t// update: function (dt) {\r\n\t//\r\n\t// },\r\n\r\n});\r\n"]}